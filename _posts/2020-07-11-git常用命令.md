---
permalink: /posts/git-commands
title: gitå‘½ä»¤æŠ€å·§æ•´ç†
tags: å·¥å…·æ•´ç†
emotag: ğŸ‘
date: 2020-07-11
last_modified_at: 2023-06-30 20:53:30 +08:00
---

<style>code {white-space : pre-wrap !important;}</style>

## å¸¸ç”¨å‘½ä»¤/æŠ€å·§

### æš‚å­˜æ›´æ”¹ä¸ºæ–‡ä»¶

```bash
git diff HEAD > FILE    # å¯¹æ¯”å·¥ä½œåŒºå’Œå½“å‰èŠ‚ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨git diff hash1 hash2å¯¹æ¯”ä¸¤ä¸ªèŠ‚ç‚¹
git apply FILE          # åº”ç”¨æ›´æ”¹
```

### å¿«é€Ÿåˆå¹¶å…¶ä»–åˆ†æ”¯

è§ä¸‹å›¾ï¼Œå½“å‰åœ¨developåˆ†æ”¯ï¼Œmasteråˆ†æ”¯è½åã€‚ç°åœ¨æƒ³å°†masterç§»åŠ¨åˆ°developä¸Šã€‚

```txt
init --- master --- ã€developã€‘
```

ç”¨ä¸¤æ¬¡checkoutåŠ ä¸€æ¬¡mergeå¯ä»¥å®ç°ï¼š

```bash
git checkout master  # åˆ‡æ¢åˆ°masteråˆ†æ”¯
git merge develop    # å°†masteråˆ†æ”¯åŒæ­¥åˆ°develop
git checkout develop # åˆ‡æ¢å›developåˆ†æ”¯
```

ä½†æ–‡ä»¶è¾ƒå¤šæˆ–å·¥ä½œåŒºæœ‰ä¿®æ”¹æ—¶è¿™ä¹ˆåšå¹¶ä¸å¤ªæ–¹ä¾¿ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¸€æ­¥åˆ°ä½ï¼š

```bash
git fetch . develop:master
git fetch . HEAD:master     # HEADä»£è¡¨å½“å‰èŠ‚ç‚¹
```

### å­æ¨¡å—ï¼ˆsubmoduleï¼‰

submoduleå¯¹äºæœ¬ä»“åº“è€Œè¨€ï¼Œä»…æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå¹¶ä¸ä¼šå°†submoduleçš„ä»£ç é‡å¤ä¸Šä¼ ï¼Œè¿™æ ·ä¿è¯äº†å…¬å…±ä»£ç åœ¨äº‘ç«¯ä»…æœ‰ä¸€ä»½ã€‚

```bash
git submodule add http://URL                    # æ·»åŠ å¼•ç”¨
git submodule update --init --recursive         # æ›´æ–°
```

### ä¸åŒç›®å½•ä½¿ç”¨ä¸åŒé…ç½®

éœ€è¦ä¿®æ”¹gitconfigæ–‡ä»¶äº†ã€‚

```bash
[includeIf "gitdir:/path/to/dir/"]
	path = /path/to/dir/.gitconfig
```

## å¸¸è§é—®é¢˜

### ä¿®æ”¹æœ¬åœ°èŠ‚ç‚¹çš„é‚®ç®±

è‹¥å·²åœ¨æœ¬åœ°ä½¿ç”¨é”™è¯¯çš„é‚®ç®±æäº¤ï¼Œå¯ä½¿ç”¨ä»¥ä¸‹è„šæœ¬ä¿®æ”¹åä¸Šä¼ ã€‚

```bash
#!/bin/sh

git filter-branch --env-filter '

OLD_EMAIL="è¦ä¿®æ”¹çš„æ—§é‚®ç®±"
CORRECT_NAME="æ­£ç¡®çš„ç”¨æˆ·å"
CORRECT_EMAIL="æ­£ç¡®çš„é‚®ç®±@é‚®ç®±.com"

if [ "$GIT_COMMITTER_EMAIL" = "$OLD_EMAIL" ]
then
    export GIT_COMMITTER_NAME="$CORRECT_NAME"
    export GIT_COMMITTER_EMAIL="$CORRECT_EMAIL"
fi
if [ "$GIT_AUTHOR_EMAIL" = "$OLD_EMAIL" ]
then
    export GIT_AUTHOR_NAME="$CORRECT_NAME"
    export GIT_AUTHOR_EMAIL="$CORRECT_EMAIL"
fi
' --tag-name-filter cat -- --branches --tags
```

## å…¨å±€è®¾ç½®

### ä½¿gitè®°ä½ç”¨æˆ·åå¯†ç 

```bash
git config --global credential.helper store
```

### è®¾ç½®ç”¨æˆ·ååŠé‚®ç®±

åœ¨ä½¿ç”¨gitä¹‹å‰ï¼Œæœ€å¥½æ­£ç¡®è®¾ç½®é‚®ç®±ååŠç”¨æˆ·åã€‚

```bash
git config --global user.name "ç”¨æˆ·å"
git config --global user.email "é‚®ç®±å@é‚®ç®±.com"
```

### å¯¹ç›®å½•æ–‡ä»¶åå¤§å°å†™æ•æ„Ÿ

```bash
git config --global core.ignorecase false
```

### ç»Ÿä¸€æ–‡ä»¶æ¢è¡Œç¬¦

```bash
# è®¾ç½®é»˜è®¤æ¢è¡Œç¬¦
git config --global core.eol crlf
# å…è®¸æ··ç”¨ lf å’Œ crlf ä¸¤ç§æ¢è¡Œç¬¦
git config --global core.safecrlf false

# å°†è‡ªåŠ¨è½¬æ¢å…³é—­ï¼Œé¿å…gitè‡ªä½œä¸»å¼ è½¬æ¢æ¢è¡Œç¬¦
# è‹¥é‡åˆ°å› ä¸ºæ¢è¡Œç¬¦ä¸åŒdiffä¸€å¤§å †çš„æƒ…å†µï¼Œå¯ä»¥è®¾ç½®ä¸ºtrueè§£å†³
git config --global core.autocrlf false
```

æœ€å¥½ä½¿ç”¨`.gitattributes`æ–‡ä»¶æ˜ç¡®æŒ‡å®šæ¢è¡Œç¬¦ï¼Œé¿å…æ‚²å‰§ï¼š

```txt
* text eol=lf
bin/** binary
```

### ä¿®æ”¹é»˜è®¤ç¼–è¾‘å™¨

```bash
git config --global core.editor vim
```

## åŒæ­¥/æ¸…ç†

### æ¸…ç†å·¥ä½œåŒºæ–‡ä»¶

```bash
git clean -dXf # (å¤§å†™X) åªæ¸…ç†.gitignoreæåˆ°çš„æ–‡ä»¶
git clean -dxf # (å°å†™x) æ¸…ç†æ‰€æœ‰æ–‡ä»¶
```

### åŒæ­¥æ‰€æœ‰æœ¬åœ°åˆ†æ”¯

å°†æœ¬åœ°æ‰€æœ‰èŠ‚ç‚¹fast-forwardåˆ°è¿œç¨‹æœ€æ–°èŠ‚ç‚¹ã€‚

```bash
curl -o /usr/local/sbin/git-ff-all https://raw.githubusercontent.com/changyuheng/git-fast-forward-all-branches/master/git-fast-forward-all
chmod +x /usr/local/sbin/git-ff-all
```

> å…è´£å£°æ˜ï¼šè„šæœ¬æ¥è‡ª https://github.com/changyuheng/git-fast-forward-all-branches

æˆ–è€…å®‰è£…[hub](https://hub.github.com/)å¹¶ä½¿ç”¨`hub sync`å‘½ä»¤ã€‚

### æ¸…ç†è¿œç«¯å·²åˆ é™¤çš„åˆ†æ”¯/æ ‡ç­¾

è¿œç«¯åˆ é™¤çš„å¼•ç”¨æœ¬åœ°å¹¶ä¸ä¼šä¸»åŠ¨åˆ é™¤ï¼Œå¯ä»¥ä½¿ç”¨ä¸‹åˆ—å‘½ä»¤æ¸…ç†ã€‚

```bash
# æ¸…ç†åˆ†æ”¯
git remote prune origin

# æ¸…ç†æ ‡ç­¾
git fetch --prune origin "+refs/tags/*:refs/tags/*"

# åŒæ—¶æ¸…ç†åˆ†æ”¯å’Œæ ‡ç­¾
git fetch origin --prune --prune-tags
```

> å…¶ä¸­originæ˜¯è¿œç«¯åå­—

### æ¸…ç†æœªè¢«å¼•ç”¨åˆ°çš„åˆ†æ”¯

å³æ²¡æœ‰è¢«åˆ†æ”¯å’Œæ ‡ç­¾å¼•ç”¨åˆ°çš„åˆ†å‰ï¼ˆæœ‰æ—¶æ‰¾å›ä»£ç é çš„å°±æ˜¯è¿™ä¸ªï¼‰ï¼Œè¿™ä¼šé€ æˆè¿™äº›åˆ†å‰æ°¸ä¹…æ¶ˆå¤±ï¼Œè¯·è°¨æ…ä½¿ç”¨ã€‚

```bash
# æ¸…ç†æœªè¢«å¼•ç”¨çš„åˆ†æ”¯
git reflog expire --expire-unreachable=now --all

# æ¸…ç†æœªè¢«å¼•ç”¨çš„åˆ†æ”¯å¹¶å‹ç¼©
git gc --prune=now
```

## ä¿¡æ¯/ç»Ÿè®¡

### æ˜¾ç¤ºåˆ†æ”¯æ‹“æ‰‘å…³ç³»

å»æ‰æ— å…³èŠ‚ç‚¹ï¼Œåªæ˜¾ç¤ºbranchå’Œtagã€‚å¿«é€Ÿç†æ¸…åˆ†æ”¯å…³ç³»ã€‚

```bash
git log --oneline --all --graph --decorate --simplify-by-decoration
gitk --simplify-by-decoration --all             # ä»…é™Windows
```

æˆ–è€…ä½¿ç”¨vscodeæ’ä»¶[git-graph](https://github.com/XUJINKAI/vscode-git-graph)

> å¸‚åœºä¸­çš„åŸç‰ˆæ’ä»¶å·²åœæ­¢ç»´æŠ¤ï¼Œè¿™æ˜¯æŸä¸ªforkï¼Œå…¶ä¸­æ˜¾ç¤ºæ‹“æ‰‘çš„åŠŸèƒ½æ˜¯æˆ‘åŠ çš„ :)

### è·å–tagä¿¡æ¯

```bash
# è·å–å½“å‰èŠ‚ç‚¹çš„tagï¼Œå½“å‰èŠ‚ç‚¹æ— tagä¼šæŠ¥é”™
git describe --tags --exact-match HEAD

# è·å–æœ€è¿‘çš„ä¸€ä¸ªtag
git describe --tags --abbrev=0

# æ ¹æ®æœ€è¿‘çš„tagè‡ªåŠ¨ç”Ÿæˆä¿¡æ¯ï¼Œæˆ‘æ¯”è¾ƒå–œæ¬¢æŠŠè¿™ä¸ªä¿¡æ¯ç¼–è¯‘åˆ°äºŒè¿›åˆ¶é‡Œ
# ä¾‹å¦‚æˆ‘ç°åœ¨è¿è¡Œç»“æœæ˜¯ v2-last-23-g97edce9-modified
# ä»£è¡¨è·ç¦»v2-lastè¿™ä¸ªæ ‡ç­¾è¿‡äº†23ä¸ªèŠ‚ç‚¹ï¼Œhashæ˜¯97edce9ï¼Œå¹¶ä¸”å·¥ä½œåŒºæœ‰ä¿®æ”¹
git describe --tags --long --dirty=-modified
```

### è·å–commitå“ˆå¸Œå€¼

```bash
git rev-parse --short HEAD  # çŸ­å“ˆå¸Œ
git rev-parse HEAD          # å®Œæ•´å“ˆå¸Œ
```

### è·å–commitæ—¥å¿—

ç”¨äºè·å–å†å²æ‰€æœ‰æäº¤ä¿¡æ¯

```bash
git log --pretty=format:"%h,%ad,%an(%ae) : %s" --date=format:'%Y-%m-%d %H:%M:%S'
```

æ·»åŠ `--no-pager`å‚æ•°å¯ä»¥è¾“å‡ºåˆ°å±å¹•

å®˜æ–¹æ–‡æ¡£ï¼š<https://git-scm.com/book/en/v2/Git-Basics-Viewing-the-Commit-History>

### ç»Ÿè®¡ä»£ç è¡Œæ•°

bashä»£ç ï¼Œéœ€è¦åœ¨linuxç¯å¢ƒæ‰§è¡Œ:

```bash
git log --format='%aE' | sort -u | while read name; do echo -en "$name\t"; git log --author="$name" --pretty=tformat: --numstat | awk '{ add += $1; subs += $2; diff += $1 + $2; loc += $1 - $2 } END { printf "add: %6s, remove: %6s, diff: %6s, sum: %6s\n", add, subs, diff, loc }' -; done
```

*æ¸©é¦¨æç¤ºï¼šä»£ç è¡Œæ•°æ— æ³•åˆ¤å®šè´¡çŒ®å€¼å¤§å°*

ç½‘ä¸Šèƒ½æœåˆ°çš„ä»£ç ä½¿ç”¨ç”¨æˆ·åç»Ÿè®¡ï¼Œè¿™é‡Œæ”¹ä¸ºä½¿ç”¨emailæ¥ç»Ÿè®¡ï¼Œå¹¶å¢åŠ äº†diffä¸€æ ã€‚
